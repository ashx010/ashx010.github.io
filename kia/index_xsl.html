<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://sl27.in/posoco/css/flush_message.css?v=1.0.0.1">
  <link rel="stylesheet" href="http://sl27.in/posoco/css/bootstrap-multiselect.css?v=1.0.0.1">
  <link rel="stylesheet" href="http://sl27.in/posoco/css/bootstrap.min.css?v=1.0.0.1">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="leaflet-routing-machine-3.2.12/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="http://sl27.in/posoco/js/jquery.min.js?v=1.0.0.1"></script>
  <script src="http://sl27.in/posoco/js/bootstrap.min.js?v=1.0.0.1"></script>
  <script src="http://sl27.in/posoco/js/bootstrap-multiselect.js?v=1.0.0.1"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.5/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>


  <script src="Delhi_State_Boundary.geojson"></script>
  <script src="Uttar_Pradesh_State_Boundary.geojson"></script>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <style>
    .popup-table {
      border-collapse: collapse;
      width: 100%;
    }

    .popup-table td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    .popup-table tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .popup-table tr:hover {
      background-color: #ddd;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid black;
      padding: 8px;
    }

    .toptable {
      margin-bottom: 20px;
    }

    .nodetablerow {
      margin-bottom: 20px;
    }

    .nodes-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }




    .geographydetailsrow {
      position: absolute;
      top: 109px;
      /* left: 170px; */
      right: 10px;
      z-index: 999;
    }


    #map {
      height: 90vh;
    }

    form#myForm {
      padding: 20px;
    }

    .form-group select {
      width: 100%;
      outline: none;
      border: none;
      background: #8dcebfb0;
      color: #333;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 1px;
      border-bottom: 2px solid #0e3657;
      padding-bottom: 11px;
    }

    /* .leaflet-marker-pane {
      display: none !important;
    }

    .leaflet-marker-pane.active {
      display: block !important;
    } 

    .leaflet-pane.leaflet-overlay-pane .leaflet-interactive {
      fill: #e8b34d;
      /* stroke: #33822c; 
    }*/
  </style>

</head>

<body>
  <div class="col-1">
    <header class="container-fluid headrow">
      <div class="col-md-3 col-xs-12">
        <div class="row">
          <div class="logosec">
            <img class="imglogo" alt="Power System Operation Corporation Limited" src="image/dart-logo.svg">
          </div>
        </div>
      </div>

      <div class="col-md-5 col-xs-12 head-midcol">
        <div class="row">
          <div class="headingsec">
            <!-- <h4>Power System Operation Corporation Limited (POSOCO)<br>(A Government of India Enterprise) CIN:
                    U40105DL2009GOI188682</h4> -->
            <h1>Dart Global Logistics</h1>
          </div>
        </div>
      </div>

      <div class="col-md-4 col-xs-12">
        <div class="row">
          <div class="usersec">
            <ul class="usernav navbar-nav">
              <li class="userdropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Demo User!<span class="glyphicon glyphicon-user pull-right"></span></a>
                <ul class="dropdown-menu">
                  <!-- <li><a href="#">Account Settings <span class="glyphicon glyphicon-cog pull-right"></span></a></li>
                <li class="divider"></li>
                <li><a href="#">User stats <span class="glyphicon glyphicon-stats pull-right"></span></a></li>
                <li class="divider"></li>
                <li><a href="#">Messages <span class="badge pull-right"> 42 </span></a></li>
                <li class="divider"></li>
                <li><a href="#">Favourites Snippets <span class="glyphicon glyphicon-heart pull-right"></span></a></li>
                <li class="divider"></li> -->
                  <li><a href="/posoco1/admins/logout">Sign Out <span class="glyphicon glyphicon-log-out pull-right"></span></a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <div class="modal fade" id="nodeModal" tabindex="-1" role="dialog" aria-labelledby="nodeModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body" id="editFrom"></div>
        </div>
      </div>
    </div>
    <div class="container-fluid loadDespatchRow">
      <div class="row">
        <!-- New Section to add map online -->

        <div class="map-container">
          <div id="map"></div>
        </div>
        <!-- New Section to add map online end -->
        <div class="node col-md-3 col-xs-12 selectbtns">
          <!-- Left Collaps button -->
          <!-- <div  class="leftcollapsebtn" data-toggle="collapse" data-target="#leftcoltab">
          <img src="http://sl27.in/posoco/img/left-collapse-button.png">
        </div> -->
          <div class="menu btn1" data-toggle="collapse" data-target="#leftcoltab">
            <div class="icon-left"></div>
            <div class="icon-right"></div>
          </div>
          <!-- Left collapse btn end -->
          <div id="leftcoltab" class="formselect collapse">
            <form name="myform" id="myForm">
              <div class="form-group">
                <select id="CouuntrySel" size="1">
                  <option value=""> Select Country</option>
                  <option value="India" selected="selected">India</option>
                </select>
              </div>
              <br>
              <div class="form-group">
                <select id="stateSel" size="1">
                  <option value="" selected="selected">Select State</option>
                  <option value="Delhi">Delhi</option>
                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                </select>
              </div>
              <br>
              <div class="form-group">
                <select id="districtSel" size="1">
                  <option value="" selected="selected">Select District</option>
                </select>
              </div>
              <br>
              <div class="form-group">
                <select id="subDistrictSel" size="1">
                  <option value="" selected="selected">Select Sub-District</option>
                </select>
              </div>
              <br>
              <div class="form-group">
                <select id="TownSel" size="1">
                  <option value="" selected="selected">Select Town</option>
                </select>
              </div>
              <br>
              <div class="form-group">
                <select id="Pin-codeSel" size="1">
                  <option value="" selected="selected">Select Pin-Code</option>
                </select>
              </div>
              <br>
              <div id="route" style="display: none;">
                <div class="form-group">
                  <select id="startRouteSel" size="1">
                    <option value="" selected="selected">Select Starting Name</option>
                  </select>
                </div>
                <br>
                <div class="form-group">
                  <select id="destRouteSel" size="1">
                    <option value="" selected="selected">Select Destination Name</option>
                  </select>
                </div>
                <br>
                <div id="samerouteloc" style="display: none;">
                  <strong style="color: 'red';">*Select Different EndPoints</strong>
                </div>
              </div>
            </form>
            <!-- Switch Section End -->
            <div id="submitBtn">
              <button type="submit" id="resetform" class="btn btn-default">Reset</button>
              <button type="button" class="btn btn-default" id='submitf'>Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-md-offset-3 col-xs-12 geographydetailsrow">
      <div class="menu btn2" data-toggle="collapse" data-target="#rightcoltab">
        <div class="icon-left"></div>
        <div class="icon-right"></div>
      </div>
      <!-- Right collapse btn end -->
      <div id="rightcoltab" class="detailsrightSec collapse">
        <!-- Top Table -->
        <!-- Geography Title Section -->
        <h2 class="geography-title">Geography Details</h2>
        <br>
        <div class="geographyhed-row">
          <!-- Export PDF Button -->
          <button onclick="generatePDF()">Generate PDF</button>
        </div>

        <br>

        <div id='pdfContent'>
          <div class="nodetablerow">
            <h2 class="nodes-title">Dart Global Logistics Details</h2>
          </div>

          <table class="table table-bordered" id="stationTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Address</th>
                <th>PinCode</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Website</th>
                <th>Product Category</th>
              </tr>
            </thead>
            <tbody id="RightCell"></tbody>
          </table>
        </div>
        <div id="colorzone" style="display: none;">
          <table class="table table-bordered" id="colortable">
            <thead>
              <th colspan="2">Zone Colour</th>
              <th>Number of Exporters</th>
            </thead>
            <tbody>
              <tr>
                <td>RED</td>
                <td bgcolor="red"></td>
                <td>0</td>
              </tr>
              <tr>
                <td>BROWN</td>
                <td bgcolor="brown"></td>
                <td>BETWEEN 1 AND 3</td>
              </tr>
              <tr>
                <td>BLUE</td>
                <td bgcolor="blue"></td>
                <td>BETWEEN 3 AND 5</td>
              </tr>
              <tr>
                <td>GREEN</td>
                <td bgcolor="green"></td>
                <td>BETWEEN 5 AND 10</td>
              </tr>
              <tr>
                <td>BLACK</td>
                <td bgcolor="black"></td>
                <td>BETWEEN 10 AND 15</td>
              </tr>
              <tr>
                <td>PURPLE</td>
                <td bgcolor="purple"></td>
                <td>MORE THAN 15</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>


          <!-- script for mapping routes -->
          <script src="https://unpkg.com/esri-leaflet@2.3.2/dist/esri-leaflet.js"
            integrity="sha512-6LVib9wGnqVKIClCduEwsCub7iauLXpwrd5njR2J507m3A2a4HXJDLMiSZzjcksag3UluIfuW1KzuWVI5n/cuQ=="
            crossorigin=""></script>

          <script src="leaflet-routing-machine-3.2.12/dist/leaflet-routing-machine.js"></script>

          <!-- script for reading excel sheets -->
          <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.0/xlsx.full.min.js"></script>

          <!-- script for html to pdf  -->
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.5/jspdf.plugin.autotable.min.js"></script>


          <script type="text/javascript">
            var mymap = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
              osmAttrib = '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
              osm = L.tileLayer(mymap, {
                maxZoom: 13,
                attribution: osmAttrib
              }),
              map = new L.Map('map', {
                center: new L.LatLng(20.5937, 78.9629),
                zoom: 5
              });
            drawnItems = L.esri.basemapLayer('Streets').addTo(map);
            L.control.layers({
              'osm': osm.addTo(map)
            }, {
              'drawlayer': drawnItems
            }, {
              position: 'topleft',
              collapsed: false
            }).addTo(map);
            L.control.zoom({
              position: 'bottomright'
            }).addTo(map);
            var popup = L.popup();
            var LeafIcon = L.Icon.extend({
              options: {
                iconSize: [36, 49],
                shadowSize: [50, 64],
                iconAnchor: [22, 94],
                shadowAnchor: [4, 62],
                popupAnchor: [-3, -76]
              }
            });

        var stateLayers = {};
        var districtLayer = null;
        var markerLayer = null;
        var subDistrictLayer = null;
        var townLayer = null;
        var pincodeLayer = null;
        var selectedStateLayer = null;
        var routelayer = null;

        var delhiDistrictData;
        var uttarPradeshDistrictData;
        var uttarPradeshSubDistrictData;
        var pincodesdelhidata; 
        var pincodesupdata;
        var subdistrictdelhidata;
        var subdistrictupdata;
        var townsdelhidata;
        var townsupdata;
        var officedata;
        var subboundarydata;
        var town_pindata;
        var filterArray = ['stateSel','districtSel','subDistrictSel','TownSel','Pin-codeSel','CompanySel','dealerSel'];

        //state data of delhi
        $.getJSON('Delhi_State_Boundary.geojson', function(data) {
            stateLayers['Delhi'] = L.geoJSON(data, {
                style: {
                    color: '#3388ff',
                    fillOpacity: 0.2,
                    weight:3
                }
            });
        });

        //state data of up
        $.getJSON('Uttar_Pradesh_State_Boundary.geojson', function(data) {
            stateLayers['Uttar Pradesh'] = L.geoJSON(data, {
                style: {
                    color: '#3388ff',
                    fillOpacity: 0.2,
                    weight: 3
                }
            });
        });

        //district data of delhi
        $.getJSON('Delhi_District_Boundary.geojson', function(data) {
          delhiDistrictData = data;
        });

        //district data of up
        $.getJSON('Uttar_Pradesh_District_Boundary.geojson', function(data) {
          uttarPradeshDistrictData = data;
        });

        //sub district data of delhi
        $.getJSON('Delhi/Geojson/Delhi_Sub_District.geojson', function(data) {
          subdistrictdelhidata = data;
        });

        //sub district data of up
        $.getJSON('up/UP_Sub_District.geojson', function(data) {
          subdistrictupdata = data;
        });

        //towns data of delhi
        $.getJSON('Delhi/Geojson/Towns_New.geojson', function(data) {
          townsdelhidata = data;
        });

        //towns data of delhi
        $.getJSON('Delhi/Geojson/Towns_Pincode_Mapping.geojson', function(data) {
          town_pindata = data;
        });

        //towns data of delhi
        $.getJSON('up/Mapping_Town_Pincode_UP.geojson', function(data) {
          uptown_pindata = data;
        });

        //towns data of up
        $.getJSON('up/UP_Towns.geojson', function(data) {
          townsupdata = data;
        });

        //pin code data of Delhi
        $.getJSON('Delhi/Geojson/Pincode_Delhi_Final1.geojson', function(data) {
          pincodesdelhidata = data;
        });

        //pin code data of Uttar Pradesh
        $.getJSON('up/UP_Pincode_New.geojson', function(data) {
          pincodesupdata = data;
        });

        // Function to fetch Excel data and provide it to a callback
        function fetchofficeData(callback) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', 'office/Exporters Final.xls', true);
          xhr.responseType = 'arraybuffer';

          xhr.onload = function () {
            var arrayBuffer = xhr.response;
            var data = new Uint8Array(arrayBuffer);
            var workbook = XLSX.read(data, { type: 'array' });
            var sheetName = workbook.SheetNames[0];
            var sheet = workbook.Sheets[sheetName];
            var officedata = XLSX.utils.sheet_to_json(sheet);

            callback(officedata); // Pass the data to the callback
          };
          xhr.send();
        }



        function routing(lat1, lang1, lat2, lang2){
          if (routelayer!=null){
            removeroutelayer();
          }

          routelayer = L.Routing.control({
            waypoints: [
              L.latLng(lat1, lang1),
              L.latLng(lat2, lang2)
            ],
            collapsible: true,
            lineOptions: {
              styles: [{color: 'black', opacity: 5, weight: 5}]
            }
          }).addTo(map);
        }

        function removeroutelayer(){
          if (routelayer != null){
            map.removeControl(routelayer);
          }
        }

        function countOccurrences(arr) {
          const counts = {};
          for (const element of arr) {
            counts[element] = (counts[element] || 0) + 1;
          }
          return counts;
        }


        // Function to create sub boundaries
        function subboundary(path, level, usr_lvl, sub_lvl_off, sub_lvl_bound, pincodesd, check=1) {

          //var pin_sub_data = {'pinc':[], 'sublvl':[]};
          var sub_data = [];

          fetchofficeData(function (officedata) {

            if(check !== 10){
              path.features.forEach(feature => {
                var condition = check === 1 ? ((feature.properties[level] == usr_lvl) || (level == usr_lvl)) : ((feature.properties[level] == usr_lvl) && (feature.properties['SUB_DIST_N'] == document.getElementById("subDistrictSel").value));
                if (condition){
                  if ((!sub_data.includes(feature.properties[sub_lvl_bound]))) {
                    sub_data.push(feature.properties[sub_lvl_bound]);
                  }
                }
              });
            }else{
              sub_data.push(usr_lvl);
            }


            var sublevel = [];
            var counts = {};

          // Call fetchofficeData and provide a callback 

            officedata.forEach(function(feature) {
              if (sub_data.includes(feature[sub_lvl_off].toString())){
                

                sublevel.push(feature[sub_lvl_off]);

                var popupContent = "<table class='popup-table'>" +
                "<tr><td><strong>NAME:</strong></td><td>" + feature.NAME + "</td></tr>" +
                "<tr><td><strong>ADDRESS:</strong></td><td>" + feature.ADDRESS + "</td></tr>" +
                "<tr><td><strong>PIN CODE:</strong></td><td>" + feature.PINCODE + "</td></tr>" +
                "<tr><td><strong>PHONE:</strong></td><td>" + feature.PHONE + "</td></tr>" +
                "<tr><td><strong>EMAIL:</strong></td><td>" + feature.EMAIL + "</td></tr>" +
                "<tr><td><strong>WEBSITE:</strong></td><td>" + feature.WEBSITE + "</td></tr>" +
                "<tr><td><strong>PRODUCT_CA:</strong></td><td>" + feature.PRODUCT + "</td></tr>" +
                "</table>";

                // Routes on the basis of offices Name
                var selstartroute = document.getElementById('startRouteSel');
                var seldestroute = document.getElementById('destRouteSel');

                var option1 = document.createElement('option');
                option1.value = feature.NAME;
                option1.textContent = feature.NAME;

                var option2 = document.createElement('option');
                option2.value = feature.NAME;
                option2.textContent = feature.NAME;

                selstartroute.appendChild(option1);
                seldestroute.appendChild(option2);

                
                var tableBody = document.getElementById('RightCell');
                var newRow = document.createElement('tr');

                var nameCell = document.createElement('td');
                nameCell.textContent = feature.NAME;

                var addressCell = document.createElement('td');
                addressCell.textContent = feature.ADDRESS;

                var pinCodeCell = document.createElement('td');
                pinCodeCell.textContent = feature.PINCODE;

                var phoneCell = document.createElement('td');
                phoneCell.textContent = feature.PHONE;

                var emailCell = document.createElement('td');
                emailCell.textContent = feature.EMAIL;

                var websiteCell = document.createElement('td');
                websiteCell.textContent = feature.WEBSITE;

                var productCategoryCell = document.createElement('td');
                productCategoryCell.textContent = feature.PRODUCT;

                newRow.appendChild(nameCell);
                newRow.appendChild(addressCell);
                newRow.appendChild(pinCodeCell);
                newRow.appendChild(phoneCell);
                newRow.appendChild(emailCell);
                newRow.appendChild(websiteCell);
                newRow.appendChild(productCategoryCell);

                tableBody.appendChild(newRow);

                L.marker([feature.LAT,feature.LONG]).addTo(Layergrp).bindPopup(popupContent);
              }
            });

            //counting number of offices 
            for (const element of sublevel) {
              counts[element] = (counts[element] || 0) + 1;
            }

          

            // adding sub layers for sub districts
            path.features.forEach(feat => {
              var condition = check === 1
                ? ((feat.properties[level] == usr_lvl) || (level == usr_lvl))
                : check === 2
                ? ((feat.properties[level] == usr_lvl) && (feat.properties['SUB_DIST_N'] == document.getElementById("subDistrictSel").value))
                : check === 10
                ? ((feat.properties[level] == usr_lvl) && (feat.properties['SUB_DIST_N'] == document.getElementById("subDistrictSel").value) && (feat.properties['NAME'] == document.getElementById('TownSel').value))
                : true; 

              if (condition){
                var layercolor = 'red';
                var layeropacity = 0.2;

                var sublvl = check !== 10 ? feat.properties[sub_lvl_bound] : usr_lvl;
                
                if ((counts[sublvl] >= 1) && (counts[sublvl] < 3)){
                  layercolor = "brown";
                  layeropacity = 0.25;
                } else if ((counts[sublvl] >= 3) && (counts[sublvl] < 5)){
                  layercolor = 'blue';
                  layeropacity = 0.15;
                } else if ((counts[sublvl] >= 5) && (counts[sublvl] < 10)){
                  layercolor = 'green';
                  layeropacity = 0.15;
                } else if ((counts[sublvl] >= 10) && (counts[sublvl] < 15)){
                  layercolor = 'black';
                  layeropacity = 0.15;
                } else if (counts[sublvl] >= 15){
                  layercolor = "purple";
                  layeropacity = 0.15;
                }
                
                L.geoJSON(feat, {
                  style: {
                    color: layercolor,
                    fillOpacity: layeropacity,
                    weight: 2.5
                  }
                }).addTo(Layergrp);
              }
            });
            document.getElementById('colorzone').style.display = 'block';
          });
        }
        

// show district options
$('#stateSel').on('change', function () {
  var selectedState = $("#stateSel").val();
  var districtSel = document.getElementById('districtSel');
  var TownSel = document.getElementById('TownSel');
  var subDistrictSel = document.getElementById('subDistrictSel');
  var pinCode = document.getElementById('Pin-codeSel');
  var selstartroute = document.getElementById('startRouteSel');
  var seldestroute = document.getElementById('destRouteSel');

  $('#districtSel').find('option').remove().end().append("<option value=''>Select District</option>");
  $('#subDistrictSel').find('option').remove().end().append("<option value=''>Select Sub District</option>");
  $('#TownSel').find('option').remove().end().append("<option value=''>Select Town</option>");
  $('#Pin-codeSel').find('option').remove().end().append("<option value=''>Select Pin Code</option>");
  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");


  var datadistrict = selectedState === 'Delhi' ? delhiDistrictData : uttarPradeshDistrictData;
  
  var districtSel = document.getElementById('districtSel');

  datadistrict.features.forEach(feature => {
    var districtName = feature.properties.DIST_NAME;
    var option = document.createElement('option');
    option.value = districtName;
    option.textContent = districtName;
    districtSel.appendChild(option);
  });
});


// show sub district options
$('#districtSel').on('change', function () {
  var selectedDistrict = $("#districtSel").val();
  var subDistrictSel =  document.getElementById('subDistrictSel');
  var TownSel =  document.getElementById('TownSel');
  var pinCode =  document.getElementById('Pin-codeSel');

  var selstartroute = document.getElementById('startRouteSel');
  var seldestroute = document.getElementById('destRouteSel');
  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");

  $('#subDistrictSel').find('option').remove().end().append("<option value=''>Select Sub District</option>");
  $('#TownSel').find('option').remove().end().append("<option value=''>Select Town</option>");
  $('#Pin-codeSel').find('option').remove().end().append("<option value=''>Select Pin Code</option>");

  var selectedState = $("#stateSel").val();

  var datasubdistrict = selectedState === 'Delhi' ? subdistrictdelhidata : subdistrictupdata;
  var bound = selectedState === 'Delhi' ? 'DIST_NAME' : 'DIST_NAME';

  var option = document.createElement('option');
  option.value = '';
  option.textContent = '';
  datasubdistrict.features.forEach(feature => {
    var districtSubCityName = feature.properties.SUB_DIST_N;
    if (selectedDistrict == feature.properties[bound]) {
      var option = document.createElement('option');
      option.value = districtSubCityName;
      option.textContent = districtSubCityName;
      subDistrictSel.appendChild(option);
    }
  });
});

// show town options
$('#subDistrictSel').on('change', function () {
  var subDistrictSel = $("#subDistrictSel").val();
  var TownSel =  document.getElementById('TownSel');
  var pinCode =  document.getElementById('Pin-codeSel');

  var selstartroute = document.getElementById('startRouteSel');
  var seldestroute = document.getElementById('destRouteSel');
  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");

  $('#TownSel').find('option').remove().end().append("<option value=''>Select Town</option>");
  $('#Pin-codeSel').find('option').remove().end().append("<option value=''>Select Pin Code</option>");

  var selectedState = $("#stateSel").val();

  var datatown = selectedState === 'Delhi' ? townsdelhidata : townsupdata;

  var option = document.createElement('option');
  option.value = '';
  option.textContent = '';
  datatown.features.forEach(feature => {
    var TownName = feature.properties.NAME;
    if (subDistrictSel == feature.properties.SUB_DIST_N) {
      var option = document.createElement('option');
      option.value = TownName;
      option.textContent = TownName;
      TownSel.appendChild(option);
    }
  });
});

// show pin code options
$('#TownSel').on('change', function () {
  var TownSel = $("#TownSel").val();
  var subDistrictSel = $("#subDistrictSel").val();
  var districtSel = $("#districtSel").val();
  var pinCode =  document.getElementById('Pin-codeSel');

  var selstartroute = document.getElementById('startRouteSel');
  var seldestroute = document.getElementById('destRouteSel');
  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");
  
  $('#Pin-codeSel').find('option').remove().end().append("<option value=''>Select Pin Code</option>");

  var selectedState = $("#stateSel").val();

  var datapin = selectedState === 'Delhi' ? 'Delhi/Geojson/Towns_Pincode_Mapping.geojson' : 'up/Mapping_Town_Pincode_UP.geojson';

    var option = document.createElement('option');
    option.value = '';
    option.textContent = '';
    $.getJSON(datapin, function(data) {
      var unicheck = {};
      data.features.forEach(feature => {
        var pin_code = feature.properties.pincode;
        if (!unicheck[pin_code]){
          if ((TownSel == feature.properties.NAME) && (subDistrictSel == feature.properties.SUB_DIST_N)) {
            unicheck[pin_code] = true;
            var option = document.createElement('option');
            option.value = pin_code;
            option.textContent = pin_code;
            pinCode.appendChild(option);
          }
        }
      });
  });
});


var Layergrp = L.layerGroup().addTo(map);

$('#resetform').on('click', function(){
  Layergrp.clearLayers();
  removeroutelayer();

  $('#stateSel').find('option').remove().end().append("<option value=''>Select State</option>");
  $('#stateSel').find('option').end().append("<option value='Delhi'>Delhi</option>");
  $('#stateSel').find('option').end().append("<option value='Uttar Pradesh'>Uttar Pradesh</option>");
  $('#districtSel').find('option').remove().end().append("<option value=''>Select District</option>");
  $('#subDistrictSel').find('option').remove().end().append("<option value=''>Select Sub District</option>");
  $('#TownSel').find('option').remove().end().append("<option value=''>Select Town</option>");
  $('#Pin-codeSel').find('option').remove().end().append("<option value=''>Select Pin Code</option>");
  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");

  map.setView([20.5937, 78.9629], 5);


});


// the submitForm function
$('#submitf').on('click', function(){

  document.getElementById('route').style.display = 'block';

  var selectedState = $("#stateSel").val();
  var selectedDistrict = $("#districtSel").val();
  var selectedSubDistrict = $("#subDistrictSel").val();
  var selectedTown = $("#TownSel").val();
  var selectedPincode = $('#Pin-codeSel').val();

  var marker = '';

  var selstartroute = $('#startRouteSel').val();
  var seldestroute = $('#destRouteSel').val();

  $('#startRouteSel').find('option').remove().end().append("<option value=''>Select Starting Name</option>");
  $('#destRouteSel').find('option').remove().end().append("<option value=''>Select Destination Name</option>");

  // Remove previous layers if exist
  Layergrp.clearLayers();
  removeroutelayer();

  // Remove table contents
  var tableBodyR = document.getElementById('RightCell');
  // Remove all child elements (rows) from the table body
  while (tableBodyR.firstChild) {
    tableBodyR.removeChild(tableBodyR.firstChild);
  }

  if (selectedState == 'Delhi') {

    if ((selectedDistrict == null || selectedDistrict == '') && (selectedSubDistrict == null || selectedSubDistrict=='') && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')){

      selectedStateLayer = stateLayers[selectedState].addTo(Layergrp);
      map.fitBounds(selectedStateLayer.getBounds());

      subboundary(delhiDistrictData, 'delhi', 'delhi', 'DIST_NAME', 'DIST_NAME', pincodesdelhidata);
    }

    if (selectedDistrict && (selectedSubDistrict == null || selectedSubDistrict=='') && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')) {
      var districtData = selectedState === 'Delhi' ? delhiDistrictData : uttarPradeshDistrictData;
      

      // selected district boundary
      districtData.features.forEach(function(feature) {
        if (feature.properties.DIST_NAME === selectedDistrict) {
          districtLayer = L.geoJSON(feature, {
            style: {
              color: 'blue',
              fillOpacity: 0.2,
              weight: 3
            }
          }).addTo(Layergrp);
        }
      });
      map.fitBounds(districtLayer.getBounds());
      subboundary(subdistrictdelhidata, 'DIST_NAME', selectedDistrict, 'SUB_DISTRICT', 'SUB_DIST_N', pincodesdelhidata);
    }


    if (selectedSubDistrict && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')) {

      subdistrictdelhidata.features.forEach(feature => {
        if (feature.properties.SUB_DIST_N == selectedSubDistrict){
          subDistrictLayer = L.geoJSON(feature, {
            style: {
              color: 'blue',
              fillOpacity: 0.2,
              weight: 3
            }
          }).addTo(Layergrp);
        }
      });

      map.fitBounds(subDistrictLayer.getBounds());
      subboundary(townsdelhidata, 'SUB_DIST_N', selectedSubDistrict, 'TOWN/VILLAGE_NAME', 'NAME', pincodesdelhidata);
    }

    if (selectedTown && (selectedPincode == null ||selectedPincode == '')) {
      townsdelhidata.features.forEach(feature => {
        if ((selectedTown === feature.properties.NAME) && (feature.properties.SUB_DIST_N === selectedSubDistrict)){
          townLayer = L.geoJSON(feature, {
            style: {
              color: 'blue',
              fillOpacity: 0.2,
              weight: 3
            }
          }).addTo(Layergrp);
        }
      });
      map.fitBounds(townLayer.getBounds());
      subboundary(town_pindata, 'NAME', selectedTown, 'PINCODE', 'pincode', pincodesdelhidata, 2);
    }


    // pinCode
    if (selectedPincode) {
      town_pindata.features.forEach(feature => {
          if ((selectedPincode == feature.properties.pincode) && (feature.properties.SUB_DIST_N == selectedSubDistrict) && (feature.properties.NAME == selectedTown)) {
            pincodeLayer = L.geoJSON(feature, {
              style: {
                color: 'red',
                fillOpacity: 0.2,
                weight: 3
              }
            }).addTo(Layergrp);
            // $("#selectedSubDistrict").text("Selected Sub-District: " + selectedSubDistrict);
            map.fitBounds(pincodeLayer.getBounds());
            subboundary(town_pindata, 'pincode', selectedPincode, 'PINCODE', 'pincode', pincodesdelhidata, 10)
          }
      });
          
    }

    //routes
    var lat1 = null;
    var lat2 = null;
    var long1 = null;
    var long2 = null;


    if (selstartroute && seldestroute){
      if (selstartroute != seldestroute){
        document.getElementById('samerouteloc').style.display = 'none';

        fetchofficeData(function(officedata){
          officedata.forEach(feature => {
            if (feature.NAME == selstartroute){
              lat1 = feature.LAT;
              long1 = feature.LONG;
            }
            if (feature.NAME == seldestroute){
              lat2 = feature.LAT;
              long2 = feature.LONG;
            }



          });
          routing(lat1, long1, lat2, long2);


          
          
        });
        
      } else{
        document.getElementById('samerouteloc').style.display = 'block';
      }
    }

  }else{

    if ((selectedDistrict == null || selectedDistrict == '') && (selectedSubDistrict == null || selectedSubDistrict=='') && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')){

      selectedStateLayer = stateLayers[selectedState].addTo(Layergrp);
      //$("#selectedState").text("Selected State: " + selectedState);
      map.fitBounds(selectedStateLayer.getBounds());

      subboundary(uttarPradeshDistrictData, 'up', 'up', 'DIST_NAME', 'DIST_NAME', pincodesupdata);
    }

    if (selectedDistrict && (selectedSubDistrict == null || selectedSubDistrict=='') && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')) {
      var districtData = selectedState === 'Delhi' ? delhiDistrictData : uttarPradeshDistrictData;
      districtData.features.forEach(function(feature) {
        if (feature.properties.DIST_NAME === selectedDistrict) {
          districtLayer = L.geoJSON(feature, {
            style: {
              color: 'blue', //#f00
              fillOpacity: 0.2,
              weight: 2
            }
          }).addTo(Layergrp);
        }
      });

      //$("#selectedDistrict").text("Selected District: " + selectedDistrict);
      map.fitBounds(districtLayer.getBounds());
      subboundary(subdistrictupdata, 'DIST_NAME', selectedDistrict, 'SUB_DISTRICT', 'SUB_DIST_N', pincodesupdata);

    }

    if (selectedSubDistrict && (selectedTown == null ||selectedTown == '') && (selectedPincode == null ||selectedPincode == '')) {
        subdistrictupdata.features.forEach(feature => {
          if (feature.properties.SUB_DIST_N === selectedSubDistrict) {
            subDistrictLayer = L.geoJSON(feature, {
              style: {
                color: 'blue',
                fillOpacity: 0.2,
                weight: 2
              }
            }).addTo(Layergrp);
          }
        });
      //$("#selectedSubDistrict").text("Selected Sub-District: " + selectedSubDistrict);
      map.fitBounds(subDistrictLayer.getBounds());
      subboundary(townsupdata, 'SUB_DIST_N', selectedSubDistrict, 'TOWN/VILLAGE_NAME', 'NAME', pincodesupdata);
    }

    if (selectedTown && (selectedPincode == null ||selectedPincode == '')) {
      townsupdata.features.forEach(feature => {
          if (selectedTown == feature.properties.NAME && feature.properties.SUB_DIST_N == selectedSubDistrict) {
            townLayer = L.geoJSON(feature, {
              style: {
                color: 'blue',
                fillOpacity: 0.2,
                weight: 2
              }
            }).addTo(Layergrp);  
          }
      });
      // $("#selectedSubDistrict").text("Selected Sub-District: " + selectedSubDistrict);
      map.fitBounds(townLayer.getBounds());
      subboundary(uptown_pindata, 'NAME', selectedTown, 'PINCODE', 'pincode', pincodesupdata, 2);

    }

    if (selectedPincode) {
      uptown_pindata.features.forEach(feature => {
        if (selectedPincode == feature.properties.pincode && feature.properties.SUB_DIST_N == selectedSubDistrict && feature.properties.NAME == selectedTown) {
          pincodeLayer = L.geoJSON(feature, {
            style: {
              color: 'blue',
              fillOpacity: 0.2,
              weight: 2
            }
          }).addTo(Layergrp);
        // $("#selectedSubDistrict").text("Selected Sub-District: " + selectedSubDistrict);
        map.fitBounds(pincodeLayer.getBounds());
        subboundary(uptown_pindata, 'pincode', selectedTown, 'PINCODE', 'pincode', pincodesupdata, 10);

        }
      });
    }
    //routes
    var lat1 = null;
    var lat2 = null;
    var long1 = null;
    var long2 = null;


    if (selstartroute && seldestroute){
      if (selstartroute != seldestroute){
        document.getElementById('samerouteloc').style.display = 'none';
        officedata.features.forEach(feature => {
          if (feature.properties.Name == selstartroute){
            lat1 = feature.properties.Lat;
            long1 = feature.properties.Long;
          }
          if (feature.properties.Name == seldestroute){
            lat2 = feature.properties.Lat;
            long2 = feature.properties.Long;
          }
        });

        routing(lat1, long1, lat2, long2);

        
      } else{
        document.getElementById('samerouteloc').style.display = 'block';
      }
    }
  }
});


function generatePDF() {
  const content = document.getElementById('pdfContent').innerHTML;
  const filename = 'geography_details.pdf';

  const options = {
    margin: 0.25,
    filename,
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a3', orientation: 'landscape' },
    // Additional style options
    image: { type: 'jpeg', quality: 0.98 },
    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] },
    font: { size: 6 },
    watermark: { text: 'Sample Watermark', alpha: 0.3 }
  };

  html2pdf().set(options).from(content).save();
}

  </script>

</body>

</html>
